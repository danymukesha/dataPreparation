<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="dataPreparation">
<title>Data Processing Phase 2 Report â€¢ dataPreparation</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Data Processing Phase 2 Report">
<meta property="og:description" content="dataPreparation">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">dataPreparation</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.0</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/dataProcessing_phase_1.html">Data Processing Phase 1 Report</a>
    <a class="dropdown-item" href="../articles/dataProcessing_phase_2.html">Data Processing Phase 2 Report</a>
  </div>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/danymukesha/dataPreparation/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Data Processing Phase 2 Report</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/danymukesha/dataPreparation/blob/HEAD/vignettes/dataProcessing_phase_2.Rmd" class="external-link"><code>vignettes/dataProcessing_phase_2.Rmd</code></a></small>
      <div class="d-none name"><code>dataProcessing_phase_2.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>This report focuses on the data processing steps involved in phase 2.
It encompasses filtering the data, transforming it using Compositional
Log-Ratio (CLR) transformation, assessing batch effects, and applying
batch correction methods such as removeBatchEffect, ComBat, PLSDA-batch,
sPLSDA-batch, and percentile normalization.</p>
<div class="section level3">
<h3 id="setup">Setup<a class="anchor" aria-label="anchor" href="#setup"></a>
</h3>
<p>In this section, we set up the necessary libraries and configurations
for the data processing tasks.</p>
</div>
<div class="section level3">
<h3 id="data-loading">Data Loading<a class="anchor" aria-label="anchor" href="#data-loading"></a>
</h3>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">categories</span> <span class="op">&lt;-</span> <span class="fu">dataPreparation</span><span class="fu">::</span><span class="va"><a href="../reference/imputed_data.html">imputed_data</a></span><span class="op">$</span><span class="va">categories</span></span>
<span><span class="va">imputed_data</span> <span class="op">&lt;-</span> <span class="fu">dataPreparation</span><span class="fu">::</span><span class="va"><a href="../reference/imputed_data.html">imputed_data</a></span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="preparing-data-for-analysis">Preparing Data for Analysis<a class="anchor" aria-label="anchor" href="#preparing-data-for-analysis"></a>
</h2>
<p>We begin by filtering the data using the <code>PreFL()</code>
function from the PLSDAbatch package to remove features with zero
variance. This step is crucial for reducing noise and improving the
quality of the dataset.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Filter the data</span></span>
<span><span class="va">filter.res</span> <span class="op">&lt;-</span> <span class="fu">PLSDAbatch</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/PLSDAbatch/man/PreFL.html" class="external-link">PreFL</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">imputed_data</span><span class="op">$</span><span class="va">data</span>, </span>
<span>                                keep.spl <span class="op">=</span> <span class="fl">0</span>, </span>
<span>                                keep.var <span class="op">=</span> <span class="fl">0.00</span><span class="op">)</span></span>
<span><span class="va">filter</span> <span class="op">&lt;-</span> <span class="va">filter.res</span><span class="op">$</span><span class="va">data.filter</span></span>
<span></span>
<span><span class="co"># Calculate zero proportion before filtering</span></span>
<span><span class="va">filter.res</span><span class="op">$</span><span class="va">zero.prob</span></span>
<span><span class="co">#&gt; [1] 0.1164276</span></span>
<span></span>
<span><span class="co"># Calculate zero proportion after filtering</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">filter</span> <span class="op">==</span> <span class="fl">0</span><span class="op">)</span> <span class="op">/</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">filter</span><span class="op">)</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">filter</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 0.1164276</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="transforming-data">Transforming Data<a class="anchor" aria-label="anchor" href="#transforming-data"></a>
</h2>
<p>Next, I transform the filtered data using the CLR transformation
method from the mixOmics package. This transformation is essential for
handling compositional data and preparing it for further analysis.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Perform CLR transformation</span></span>
<span><span class="va">clr</span> <span class="op">&lt;-</span> <span class="fu">mixOmics</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/mixOmics/man/logratio-transformations.html" class="external-link">logratio.transfo</a></span><span class="op">(</span>X <span class="op">=</span> <span class="va">filter</span>, logratio <span class="op">=</span> <span class="st">'CLR'</span>, offset <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> </span>
<span><span class="fu"><a href="https://rdrr.io/r/base/class.html" class="external-link">class</a></span><span class="op">(</span><span class="va">clr</span><span class="op">)</span> <span class="op">=</span> <span class="st">'matrix'</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="assessing-batch-effects">Assessing Batch Effects<a class="anchor" aria-label="anchor" href="#assessing-batch-effects"></a>
</h2>
<p>Before applying batch correction methods, we assess batch effects in
the data using principal component analysis (PCA) and variance
partitioning analysis (pRDA). Understanding the sources of variation in
the data is crucial for selecting appropriate batch correction
techniques.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Perform PCA</span></span>
<span><span class="va">pca.before</span> <span class="op">&lt;-</span> <span class="fu">mixOmics</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/mixOmics/man/pca.html" class="external-link">pca</a></span><span class="op">(</span><span class="va">clr</span>, ncomp <span class="op">=</span> <span class="fl">4</span>, scale <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="va">batch</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">categories</span><span class="op">$</span><span class="va">Submission.Name</span>, levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">categories</span><span class="op">$</span><span class="va">Submission.Name</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">descr</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">categories</span><span class="op">$</span><span class="va">Sample.Description</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">batch</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">descr</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">categories</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Perform pRDA</span></span>
<span><span class="va">factors.df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>trt <span class="op">=</span> <span class="va">descr</span>, batch <span class="op">=</span> <span class="va">batch</span><span class="op">)</span></span>
<span><span class="va">rda.before</span> <span class="op">&lt;-</span> <span class="fu">vegan</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/vegan/man/varpart.html" class="external-link">varpart</a></span><span class="op">(</span><span class="va">clr</span>, <span class="op">~</span> <span class="va">descr</span>, <span class="op">~</span> <span class="va">batch</span>, </span>
<span>                             data <span class="op">=</span> <span class="va">factors.df</span>, </span>
<span>                             scale <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">rda.before</span><span class="op">$</span><span class="va">part</span><span class="op">$</span><span class="va">indfract</span></span>
<span><span class="co">#&gt;                 Df R.squared Adj.R.squared Testable</span></span>
<span><span class="co">#&gt; [a] = X1|X2      3        NA   0.010742410     TRUE</span></span>
<span><span class="co">#&gt; [b] = X2|X1      2        NA   0.063271790     TRUE</span></span>
<span><span class="co">#&gt; [c]              0        NA   0.008237267    FALSE</span></span>
<span><span class="co">#&gt; [d] = Residuals NA        NA   0.917748533    FALSE</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="batch-correction">Batch Correction<a class="anchor" aria-label="anchor" href="#batch-correction"></a>
</h2>
<p>I apply various batch correction methods, including
<code>removeBatchEffect</code>, <code>ComBat</code>,
<code>PLSDA-batch</code>, and <code>sPLSDA-batch</code>, to mitigate
batch effects in the data. These methods adjust for technical variation
introduced by batch processing and improve the accuracy of downstream
analysis.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Managing batch effects</span></span>
<span><span class="va">clr</span> <span class="op">&lt;-</span> <span class="va">clr</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_len</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">clr</span><span class="op">)</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_len</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">clr</span><span class="op">)</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="va">lm</span> <span class="op">&lt;-</span> <span class="fu">PLSDAbatch</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/PLSDAbatch/man/linear_regres.html" class="external-link">linear_regres</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">clr</span>, trt <span class="op">=</span> <span class="va">descr</span>, </span>
<span>                       batch.fix <span class="op">=</span> <span class="va">batch</span>, type <span class="op">=</span> <span class="st">'linear model'</span><span class="op">)</span></span>
<span></span>
<span><span class="va">p</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="va">lm</span><span class="op">$</span><span class="va">lm.table</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">{</span><span class="va">x</span><span class="op">$</span><span class="va">coefficients</span><span class="op">[</span><span class="fl">2</span>,<span class="fl">4</span><span class="op">]</span><span class="op">}</span><span class="op">)</span></span>
<span><span class="va">p.adj</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/p.adjust.html" class="external-link">p.adjust</a></span><span class="op">(</span>p <span class="op">=</span> <span class="va">p</span>, method <span class="op">=</span> <span class="st">'fdr'</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">performance</span><span class="fu">::</span><span class="fu"><a href="https://easystats.github.io/performance/reference/check_model.html" class="external-link">check_model</a></span><span class="op">(</span><span class="va">lm</span><span class="op">$</span><span class="va">model</span><span class="op">$</span><span class="va">AC.0.0.</span><span class="op">)</span></span></code></pre></div>
<p><img src="dataProcessing_phase_2_files/figure-html/unnamed-chunk-7-1.png" width="700"></p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">mod</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/model.matrix.html" class="external-link">model.matrix</a></span><span class="op">(</span> <span class="op">~</span> <span class="va">descr</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Applying removeBatchEffect</span></span>
<span><span class="va">rBE</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="fu">limma</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/limma/man/removeBatchEffect.html" class="external-link">removeBatchEffect</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="va">clr</span><span class="op">)</span>, batch <span class="op">=</span> <span class="va">batch</span>, </span>
<span>                              design <span class="op">=</span> <span class="va">mod</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Applying ComBat</span></span>
<span><span class="va">ComBat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="fu">sva</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/sva/man/ComBat.html" class="external-link">ComBat</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="va">clr</span><span class="op">)</span>, batch <span class="op">=</span> <span class="va">batch</span>, </span>
<span>                      mod <span class="op">=</span> <span class="va">mod</span>, par.prior <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; Found3batches</span></span>
<span><span class="co">#&gt; Adjusting for3covariate(s) or covariate level(s)</span></span>
<span><span class="co">#&gt; Standardizing Data across genes</span></span>
<span><span class="co">#&gt; Fitting L/S model and finding priors</span></span>
<span><span class="co">#&gt; Finding nonparametric adjustments</span></span>
<span><span class="co">#&gt; Adjusting the Data</span></span>
<span></span>
<span><span class="co"># Applying PLSDA-batch</span></span>
<span><span class="va">trt.tune</span> <span class="op">&lt;-</span> <span class="fu">mixOmics</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/mixOmics/man/plsda.html" class="external-link">plsda</a></span><span class="op">(</span>X <span class="op">=</span> <span class="va">clr</span>, Y <span class="op">=</span> <span class="va">descr</span>, ncomp <span class="op">=</span> <span class="fl">5</span><span class="op">)</span></span>
<span><span class="va">trt.tune</span><span class="op">$</span><span class="va">prop_expl_var</span> <span class="co">#1</span></span>
<span><span class="co">#&gt; $X</span></span>
<span><span class="co">#&gt;      comp1      comp2      comp3      comp4      comp5 </span></span>
<span><span class="co">#&gt; 0.26290693 0.12924845 0.05638917 0.03215048 0.02706694 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $Y</span></span>
<span><span class="co">#&gt;     comp1     comp2     comp3     comp4     comp5 </span></span>
<span><span class="co">#&gt; 0.3476251 0.2891150 0.3600766 0.2659962 0.2676497</span></span>
<span><span class="va">ad.batch.tune</span> <span class="op">&lt;-</span> <span class="fu">PLSDAbatch</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/PLSDAbatch/man/PLSDA_batch.html" class="external-link">PLSDA_batch</a></span><span class="op">(</span>X <span class="op">=</span> <span class="va">clr</span>, </span>
<span>                             Y.trt <span class="op">=</span> <span class="va">descr</span>, Y.bat <span class="op">=</span> <span class="va">batch</span>,</span>
<span>                             ncomp.trt <span class="op">=</span> <span class="fl">1</span>, ncomp.bat <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span>
<span><span class="va">ad.batch.tune</span><span class="op">$</span><span class="va">explained_variance.bat</span> <span class="co">#4</span></span>
<span><span class="co">#&gt; $X</span></span>
<span><span class="co">#&gt;      comp1      comp2      comp3      comp4      comp5      comp6      comp7 </span></span>
<span><span class="co">#&gt; 0.14292479 0.10174322 0.04409038 0.05767321 0.02997094 0.02896939 0.03965851 </span></span>
<span><span class="co">#&gt;      comp8      comp9     comp10 </span></span>
<span><span class="co">#&gt; 0.02523240 0.02492387 0.02929685 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $Y</span></span>
<span><span class="co">#&gt;        comp1        comp2        comp3        comp4        comp5        comp6 </span></span>
<span><span class="co">#&gt; 5.341427e-01 4.658573e-01 4.462800e-01 5.536993e-01 2.076144e-05 4.561109e-01 </span></span>
<span><span class="co">#&gt;        comp7        comp8        comp9       comp10 </span></span>
<span><span class="co">#&gt; 5.438691e-01 2.002938e-05 4.534041e-01 5.465765e-01</span></span>
<span><span class="va">PLSDA_batch.res</span> <span class="op">&lt;-</span> <span class="fu">PLSDAbatch</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/PLSDAbatch/man/PLSDA_batch.html" class="external-link">PLSDA_batch</a></span><span class="op">(</span>X <span class="op">=</span> <span class="va">clr</span>, </span>
<span>                                  Y.trt <span class="op">=</span> <span class="va">descr</span>, Y.bat <span class="op">=</span> <span class="va">batch</span>,</span>
<span>                                  ncomp.trt <span class="op">=</span> <span class="fl">1</span>, ncomp.bat <span class="op">=</span> <span class="fl">4</span><span class="op">)</span></span>
<span><span class="va">PLSDA_batch</span> <span class="op">&lt;-</span> <span class="va">PLSDA_batch.res</span><span class="op">$</span><span class="va">X.nobatch</span></span>
<span></span>
<span><span class="co"># Applying sPLSDA-path</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">777</span><span class="op">)</span></span>
<span><span class="va">test.keepX</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">10</span>, <span class="fl">1</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">20</span>, <span class="fl">100</span>, <span class="fl">10</span><span class="op">)</span>, </span>
<span>                  <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">150</span>, <span class="fl">231</span>, <span class="fl">50</span><span class="op">)</span>, <span class="fl">231</span><span class="op">)</span></span>
<span><span class="va">trt.tune.v</span> <span class="op">&lt;-</span> <span class="fu">mixOmics</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/mixOmics/man/tune.splsda.html" class="external-link">tune.splsda</a></span><span class="op">(</span>X <span class="op">=</span> <span class="va">clr</span>, Y <span class="op">=</span> <span class="va">descr</span>, </span>
<span>                             ncomp <span class="op">=</span> <span class="fl">1</span>, test.keepX <span class="op">=</span> <span class="va">test.keepX</span>, </span>
<span>                             validation <span class="op">=</span> <span class="st">'Mfold'</span>, folds <span class="op">=</span> <span class="fl">4</span>, </span>
<span>                             nrepeat <span class="op">=</span> <span class="fl">50</span><span class="op">)</span></span>
<span><span class="va">trt.tune.v</span><span class="op">$</span><span class="va">choice.keepX</span></span>
<span><span class="co">#&gt; comp1 </span></span>
<span><span class="co">#&gt;    10</span></span>
<span><span class="va">batch.tune</span> <span class="op">&lt;-</span> <span class="fu">PLSDAbatch</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/PLSDAbatch/man/PLSDA_batch.html" class="external-link">PLSDA_batch</a></span><span class="op">(</span>X <span class="op">=</span> <span class="va">clr</span>, </span>
<span>                             Y.trt <span class="op">=</span> <span class="va">descr</span>, Y.bat <span class="op">=</span> <span class="va">batch</span>,</span>
<span>                             ncomp.trt <span class="op">=</span> <span class="fl">1</span>, keepX.trt <span class="op">=</span> <span class="fl">100</span>,</span>
<span>                             ncomp.bat <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span>
<span><span class="va">batch.tune</span><span class="op">$</span><span class="va">explained_variance.bat</span> <span class="co">#4</span></span>
<span><span class="co">#&gt; $X</span></span>
<span><span class="co">#&gt;      comp1      comp2      comp3      comp4      comp5      comp6      comp7 </span></span>
<span><span class="co">#&gt; 0.14466418 0.19348074 0.03894402 0.04894104 0.03372545 0.04020103 0.01913727 </span></span>
<span><span class="co">#&gt;      comp8      comp9     comp10 </span></span>
<span><span class="co">#&gt; 0.02467613 0.01411173 0.02207250 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $Y</span></span>
<span><span class="co">#&gt;       comp1       comp2       comp3       comp4       comp5       comp6 </span></span>
<span><span class="co">#&gt; 0.547906095 0.452093905 0.459599014 0.538221131 0.002179855 0.498738183 </span></span>
<span><span class="co">#&gt;       comp7       comp8       comp9      comp10 </span></span>
<span><span class="co">#&gt; 0.499292933 0.001968885 0.524672205 0.473370097</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">batch.tune</span><span class="op">$</span><span class="va">explained_variance.bat</span><span class="op">$</span><span class="va">Y</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_len</a></span><span class="op">(</span><span class="fl">4</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 1.99782</span></span>
<span><span class="va">sPLSDA_batch.res</span> <span class="op">&lt;-</span> <span class="fu">PLSDAbatch</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/PLSDAbatch/man/PLSDA_batch.html" class="external-link">PLSDA_batch</a></span><span class="op">(</span>X <span class="op">=</span> <span class="va">clr</span>, </span>
<span>                                   Y.trt <span class="op">=</span> <span class="va">descr</span>, Y.bat <span class="op">=</span> <span class="va">batch</span>,</span>
<span>                                   ncomp.trt <span class="op">=</span> <span class="fl">1</span>, keepX.trt <span class="op">=</span> <span class="fl">100</span>,</span>
<span>                                   ncomp.bat <span class="op">=</span> <span class="fl">4</span><span class="op">)</span></span>
<span><span class="va">sPLSDA_batch</span> <span class="op">&lt;-</span> <span class="va">sPLSDA_batch.res</span><span class="op">$</span><span class="va">X.nobatch</span></span>
<span></span>
<span><span class="co"># Applying PN</span></span>
<span><span class="va">PN</span> <span class="op">&lt;-</span> <span class="fu">PLSDAbatch</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/PLSDAbatch/man/percentile_norm.html" class="external-link">percentile_norm</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">clr</span>, batch <span class="op">=</span> <span class="va">batch</span>, </span>
<span>                         trt <span class="op">=</span> <span class="va">descr</span>, ctrl.grp <span class="op">=</span> <span class="st">'0-0.5'</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="evaluating-batch-correction">Evaluating Batch Correction<a class="anchor" aria-label="anchor" href="#evaluating-batch-correction"></a>
</h2>
<p>To evaluate the effectiveness of batch correction methods, I compare
the variance explained by treatment and batch factors before and after
correction. I also assess the impact of correction on the distribution
of samples using scatter plots and density plots.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Perform PCA after batch correction</span></span>
<span><span class="va">pca.rBE</span> <span class="op">&lt;-</span> <span class="fu">mixOmics</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/mixOmics/man/pca.html" class="external-link">pca</a></span><span class="op">(</span><span class="va">rBE</span>, ncomp <span class="op">=</span> <span class="fl">3</span>, scale <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">pca.ComBat</span> <span class="op">&lt;-</span> <span class="fu">mixOmics</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/mixOmics/man/pca.html" class="external-link">pca</a></span><span class="op">(</span><span class="va">ComBat</span>, ncomp <span class="op">=</span> <span class="fl">3</span>, scale <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">pca.PLSDA_batch</span> <span class="op">&lt;-</span> <span class="fu">mixOmics</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/mixOmics/man/pca.html" class="external-link">pca</a></span><span class="op">(</span><span class="va">PLSDA_batch</span>, ncomp <span class="op">=</span> <span class="fl">3</span>, scale <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">pca.sPLSDA_batch</span> <span class="op">&lt;-</span> <span class="fu">mixOmics</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/mixOmics/man/pca.html" class="external-link">pca</a></span><span class="op">(</span><span class="va">sPLSDA_batch</span>, ncomp <span class="op">=</span> <span class="fl">3</span>, scale <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="selecting-features">Selecting Features<a class="anchor" aria-label="anchor" href="#selecting-features"></a>
</h2>
<p>Finally, we select features that are relevant for discrimination
between treatment groups using sparse partial least squares discriminant
analysis (sPLSDA). This step helps identify biomarkers or features that
contribute significantly to group separation and biological
interpretation.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># order batches</span></span>
<span><span class="va">batch</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">categories</span><span class="op">$</span><span class="va">Submission.Name</span>, </span>
<span>               levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">categories</span><span class="op">$</span><span class="va">Submission.Name</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">pca.before.plot</span> <span class="op">&lt;-</span> <span class="fu">PLSDAbatch</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/PLSDAbatch/man/Scatter_Density.html" class="external-link">Scatter_Density</a></span><span class="op">(</span>object <span class="op">=</span> <span class="va">pca.before</span>, </span>
<span>                                      batch <span class="op">=</span> <span class="va">batch</span>, </span>
<span>                                      trt <span class="op">=</span> <span class="va">descr</span>, </span>
<span>                                      title <span class="op">=</span> <span class="st">'Before correction'</span><span class="op">)</span></span></code></pre></div>
<p><img src="dataProcessing_phase_2_files/figure-html/unnamed-chunk-11-1.png" width="700"></p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pca.rBE.plot</span> <span class="op">&lt;-</span> <span class="fu">PLSDAbatch</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/PLSDAbatch/man/Scatter_Density.html" class="external-link">Scatter_Density</a></span><span class="op">(</span>object <span class="op">=</span> <span class="va">pca.rBE</span>, </span>
<span>                                   batch <span class="op">=</span> <span class="va">batch</span>, </span>
<span>                                   trt <span class="op">=</span> <span class="va">descr</span>, </span>
<span>                                   title <span class="op">=</span> <span class="st">'removeBatchEffect'</span><span class="op">)</span></span></code></pre></div>
<p><img src="dataProcessing_phase_2_files/figure-html/unnamed-chunk-11-2.png" width="700"></p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pca.ComBat.plot</span> <span class="op">&lt;-</span> <span class="fu">PLSDAbatch</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/PLSDAbatch/man/Scatter_Density.html" class="external-link">Scatter_Density</a></span><span class="op">(</span>object <span class="op">=</span> <span class="va">pca.ComBat</span>, </span>
<span>                                      batch <span class="op">=</span> <span class="va">batch</span>, </span>
<span>                                      trt <span class="op">=</span> <span class="va">descr</span>, </span>
<span>                                      title <span class="op">=</span> <span class="st">'ComBat'</span><span class="op">)</span></span></code></pre></div>
<p><img src="dataProcessing_phase_2_files/figure-html/unnamed-chunk-11-3.png" width="700"></p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pca.PLSDA_batch.plot</span> <span class="op">&lt;-</span> <span class="fu">PLSDAbatch</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/PLSDAbatch/man/Scatter_Density.html" class="external-link">Scatter_Density</a></span><span class="op">(</span>object <span class="op">=</span> <span class="va">pca.PLSDA_batch</span>, </span>
<span>                                           batch <span class="op">=</span> <span class="va">batch</span>, </span>
<span>                                           trt <span class="op">=</span> <span class="va">descr</span>, </span>
<span>                                           title <span class="op">=</span> <span class="st">'PLSDA-batch'</span><span class="op">)</span></span></code></pre></div>
<p><img src="dataProcessing_phase_2_files/figure-html/unnamed-chunk-11-4.png" width="700"></p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pca.sPLSDA_batch.plot</span> <span class="op">&lt;-</span> <span class="fu">PLSDAbatch</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/PLSDAbatch/man/Scatter_Density.html" class="external-link">Scatter_Density</a></span><span class="op">(</span>object <span class="op">=</span> <span class="va">pca.sPLSDA_batch</span>, </span>
<span>                                            batch <span class="op">=</span> <span class="va">batch</span>, </span>
<span>                                            trt <span class="op">=</span> <span class="va">descr</span>, </span>
<span>                                            title <span class="op">=</span> <span class="st">'sPLSDA-batch'</span><span class="op">)</span></span></code></pre></div>
<p><img src="dataProcessing_phase_2_files/figure-html/unnamed-chunk-11-5.png" width="700"></p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">g</span> <span class="op">&lt;-</span> <span class="fu">ggpubr</span><span class="fu">::</span><span class="fu"><a href="https://rpkgs.datanovia.com/ggpubr/reference/ggarrange.html" class="external-link">ggarrange</a></span><span class="op">(</span><span class="va">pca.before.plot</span>, </span>
<span>          <span class="va">pca.rBE.plot</span>,</span>
<span>          <span class="va">pca.ComBat.plot</span>,</span>
<span>          <span class="va">pca.PLSDA_batch.plot</span>,</span>
<span>          <span class="va">pca.sPLSDA_batch.plot</span>,</span>
<span>          labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"A"</span>, <span class="st">"B"</span>, <span class="st">"C"</span>, <span class="st">"D"</span>, <span class="st">"E"</span><span class="op">)</span>,</span>
<span>          ncol <span class="op">=</span> <span class="fl">2</span>, nrow <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">corrected.list</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>`Before correction` <span class="op">=</span> <span class="va">clr</span>, </span>
<span>                          removeBatchEffect <span class="op">=</span> <span class="va">rBE</span>, </span>
<span>                          ComBat <span class="op">=</span> <span class="va">ComBat</span>,</span>
<span>                          `PLSDA-batch` <span class="op">=</span> <span class="va">PLSDA_batch</span>,</span>
<span>                          `sPLSDA-batch` <span class="op">=</span> <span class="va">sPLSDA_batch</span></span>
<span>                          <span class="co"># `Percentile Normalisation` = PN,</span></span>
<span>                          <span class="co"># RUVIII = RUVIII</span></span>
<span>                          <span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">factors.df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>trt <span class="op">=</span> <span class="va">descr</span>, batch <span class="op">=</span> <span class="va">batch</span><span class="op">)</span></span>
<span></span>
<span><span class="va">prop.df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="st">"Disease Pheno"</span> <span class="op">=</span> <span class="cn">NA</span>, Batch <span class="op">=</span> <span class="cn">NA</span>, </span>
<span>                         Intersection <span class="op">=</span> <span class="cn">NA</span>, </span>
<span>                         Residuals <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span> </span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_len</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">corrected.list</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">rda.res</span> <span class="op">=</span> <span class="fu">vegan</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/vegan/man/varpart.html" class="external-link">varpart</a></span><span class="op">(</span><span class="va">corrected.list</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span>, <span class="op">~</span> <span class="va">descr</span>, <span class="op">~</span> <span class="va">batch</span>,</span>
<span>                    data <span class="op">=</span> <span class="va">factors.df</span>, scale <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span>  <span class="va">prop.df</span><span class="op">[</span><span class="va">i</span>, <span class="op">]</span> <span class="op">&lt;-</span> <span class="va">rda.res</span><span class="op">$</span><span class="va">part</span><span class="op">$</span><span class="va">indfract</span><span class="op">$</span><span class="va">Adj.R.squared</span><span class="op">}</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">prop.df</span><span class="op">)</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">corrected.list</span><span class="op">)</span></span>
<span></span>
<span><span class="va">prop.df</span> <span class="op">&lt;-</span> <span class="va">prop.df</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">3</span>,<span class="fl">2</span>,<span class="fl">4</span><span class="op">)</span><span class="op">]</span></span>
<span></span>
<span><span class="va">prop.df</span><span class="op">[</span><span class="va">prop.df</span> <span class="op">&lt;</span> <span class="fl">0</span><span class="op">]</span> <span class="op">=</span> <span class="fl">0</span></span>
<span><span class="va">prop.df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="va">prop.df</span>, <span class="fl">1</span>, </span>
<span>                                    <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">{</span><span class="va">x</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">}</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">PLSDAbatch</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/PLSDAbatch/man/partVar_plot.html" class="external-link">partVar_plot</a></span><span class="op">(</span>prop.df <span class="op">=</span> <span class="va">prop.df</span><span class="op">)</span></span></code></pre></div>
<p><img src="dataProcessing_phase_2_files/figure-html/unnamed-chunk-14-1.png" width="700"></p>
<div class="section level3">
<h3 id="other-methods">other methods<a class="anchor" aria-label="anchor" href="#other-methods"></a>
</h3>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">d</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu">dataPreparation</span><span class="fu">::</span><span class="fu"><a href="../reference/visualize_batch_correction.html">visualize_batch_correction</a></span><span class="op">(</span></span>
<span>    corrected_list <span class="op">=</span> <span class="va">corrected.list</span>,</span>
<span>    categories <span class="op">=</span> <span class="va">categories</span>,</span>
<span>    visualization_type <span class="op">=</span> <span class="st">"barplot"</span></span>
<span>  <span class="op">)</span></span>
<span><span class="va">d</span></span></code></pre></div>
<p><img src="dataProcessing_phase_2_files/figure-html/unnamed-chunk-15-1.png" width="700"></p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">splsda.select</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_len</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">corrected.list</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">splsda.res</span> <span class="op">&lt;-</span> <span class="fu">mixOmics</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/mixOmics/man/splsda.html" class="external-link">splsda</a></span><span class="op">(</span>X <span class="op">=</span> <span class="va">corrected.list</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span>, Y <span class="op">=</span> <span class="va">descr</span>, </span>
<span>                       ncomp <span class="op">=</span> <span class="fl">3</span>, keepX <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">50</span>,<span class="fl">3</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">select.res</span> <span class="op">&lt;-</span> <span class="fu">mixOmics</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/mixOmics/man/selectVar.html" class="external-link">selectVar</a></span><span class="op">(</span><span class="va">splsda.res</span>, comp <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">$</span><span class="va">name</span></span>
<span>  <span class="va">splsda.select</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">select.res</span></span>
<span><span class="op">}</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">splsda.select</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">corrected.list</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># can only visualize 5 methods</span></span>
<span><span class="va">splsda.select</span> <span class="op">&lt;-</span> <span class="va">splsda.select</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_len</a></span><span class="op">(</span><span class="fl">5</span><span class="op">)</span><span class="op">]</span></span>
<span></span>
<span><span class="va">splsda.upsetR</span> <span class="op">&lt;-</span> <span class="fu">UpSetR</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/UpSetR/man/fromList.html" class="external-link">fromList</a></span><span class="op">(</span><span class="va">splsda.select</span><span class="op">)</span></span>
<span></span>
<span><span class="va">p</span> <span class="op">&lt;-</span>  <span class="fu">UpSetR</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/UpSetR/man/upset.html" class="external-link">upset</a></span><span class="op">(</span><span class="va">splsda.upsetR</span>, main.bar.color <span class="op">=</span> <span class="st">'gray36'</span>,</span>
<span>      sets.bar.color <span class="op">=</span> <span class="fu">PLSDAbatch</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/PLSDAbatch/man/pb_color.html" class="external-link">pb_color</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">25</span><span class="op">:</span><span class="fl">22</span>,<span class="fl">20</span><span class="op">)</span><span class="op">)</span>, matrix.color <span class="op">=</span> <span class="st">'gray36'</span>,</span>
<span>      order.by <span class="op">=</span> <span class="st">'freq'</span>, empty.intersections <span class="op">=</span> <span class="st">'on'</span>,</span>
<span>      queries <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>query <span class="op">=</span> <span class="va">intersects</span>, </span>
<span>                          params <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">'Before correction'</span><span class="op">)</span>, </span>
<span>                          color <span class="op">=</span> <span class="fu">PLSDAbatch</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/PLSDAbatch/man/pb_color.html" class="external-link">pb_color</a></span><span class="op">(</span><span class="fl">20</span><span class="op">)</span>, active <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>                     <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>query <span class="op">=</span> <span class="va">intersects</span>, </span>
<span>                          params <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">'removeBatchEffect'</span><span class="op">)</span>, </span>
<span>                          color <span class="op">=</span> <span class="fu">PLSDAbatch</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/PLSDAbatch/man/pb_color.html" class="external-link">pb_color</a></span><span class="op">(</span><span class="fl">22</span><span class="op">)</span>, active <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>                     <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>query <span class="op">=</span> <span class="va">intersects</span>, </span>
<span>                          params <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">'ComBat'</span><span class="op">)</span>, </span>
<span>                          color <span class="op">=</span> <span class="fu">PLSDAbatch</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/PLSDAbatch/man/pb_color.html" class="external-link">pb_color</a></span><span class="op">(</span><span class="fl">23</span><span class="op">)</span>, active <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>                     <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>query <span class="op">=</span> <span class="va">intersects</span>, </span>
<span>                          params <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">'PLSDA-batch'</span><span class="op">)</span>, </span>
<span>                          color <span class="op">=</span> <span class="fu">PLSDAbatch</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/PLSDAbatch/man/pb_color.html" class="external-link">pb_color</a></span><span class="op">(</span><span class="fl">24</span><span class="op">)</span>, active <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>                     <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>query <span class="op">=</span> <span class="va">intersects</span>, </span>
<span>                          params <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">'sPLSDA-batch'</span><span class="op">)</span>, </span>
<span>                          color <span class="op">=</span> <span class="fu">PLSDAbatch</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/PLSDAbatch/man/pb_color.html" class="external-link">pb_color</a></span><span class="op">(</span><span class="fl">25</span><span class="op">)</span>, active <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="display-up">Display Up<a class="anchor" aria-label="anchor" href="#display-up"></a>
</h2>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">p</span></span></code></pre></div>
<p><img src="dataProcessing_phase_2_files/figure-html/unnamed-chunk-18-1.png" width="700"></p>
</div>
<div class="section level2">
<h2 id="performing-principal-component-analysis-pca-after-batch-effect-correction">Performing Principal Component Analysis (PCA After Batch Effect
Correction)<a class="anchor" aria-label="anchor" href="#performing-principal-component-analysis-pca-after-batch-effect-correction"></a>
</h2>
<p>Principal Component Analysis (PCA) is a dimensionality reduction
technique that helps visualize the variation in the dataset. Here, I
perform PCA on the preprocessed data and create a PCA plot for
visualization.</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">t</span> <span class="op">&lt;-</span> <span class="va">rBE</span></span>
<span><span class="co"># Perform PCA</span></span>
<span><span class="va">pca_result</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/prcomp.html" class="external-link">prcomp</a></span><span class="op">(</span><span class="va">t</span>, scale. <span class="op">=</span> <span class="cn">TRUE</span>, center <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Extract PCA scores</span></span>
<span><span class="va">pca_scores</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="va">pca_result</span><span class="op">$</span><span class="va">x</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Combine PCA scores with categories for visualization</span></span>
<span><span class="va">pca_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">pca_scores</span>, <span class="va">imputed_data</span><span class="op">$</span><span class="va">categories</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Create PCA plot</span></span>
<span><span class="va">pca_plot</span> <span class="op">&lt;-</span> <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">pca_data</span>, </span>
<span>                            <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">PC1</span>, y <span class="op">=</span> <span class="va">PC2</span>, </span>
<span>                                         color <span class="op">=</span> <span class="va">Submission.Name</span>, </span>
<span>                                         shape <span class="op">=</span> <span class="va">Sample.Description</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_shape_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">16</span>, <span class="fl">17</span>, <span class="fl">18</span>, <span class="fl">19</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span></span>
<span>      title <span class="op">=</span> <span class="st">"PCA Plot (After Batch Effect Correction)"</span>,</span>
<span>      x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span></span>
<span>        <span class="st">"PC1 (Explained Variance: "</span>,</span>
<span>        <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">pca_result</span><span class="op">$</span><span class="va">sdev</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">^</span> <span class="fl">2</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">pca_result</span><span class="op">$</span><span class="va">sdev</span> <span class="op">^</span> <span class="fl">2</span><span class="op">)</span> <span class="op">*</span> <span class="fl">100</span>, <span class="fl">2</span><span class="op">)</span>,</span>
<span>        <span class="st">"%)"</span></span>
<span>      <span class="op">)</span>,</span>
<span>      y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span></span>
<span>        <span class="st">"PC2 (Explained Variance: "</span>,</span>
<span>        <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">pca_result</span><span class="op">$</span><span class="va">sdev</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span> <span class="op">^</span> <span class="fl">2</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">pca_result</span><span class="op">$</span><span class="va">sdev</span> <span class="op">^</span> <span class="fl">2</span><span class="op">)</span> <span class="op">*</span> <span class="fl">100</span>, <span class="fl">2</span><span class="op">)</span>,</span>
<span>        <span class="st">"%)"</span></span>
<span>      <span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span></span>
<span><span class="co"># Display PCA plot</span></span>
<span><span class="va">pca_plot</span></span></code></pre></div>
<p><img src="dataProcessing_phase_2_files/figure-html/unnamed-chunk-20-1.png" width="700"></p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">imputed_data</span><span class="op">$</span><span class="va">rBE</span> <span class="op">&lt;-</span> <span class="va">rBE</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/write.table.html" class="external-link">write.csv</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">imputed_data</span><span class="op">$</span><span class="va">rBE</span>, </span>
<span>          file <span class="op">=</span> <span class="st">"../inst/data_to_use/imputed_data_after_Batch_Correction.csv"</span>, </span>
<span>          row.names <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="fu">usethis</span><span class="fu">::</span><span class="fu"><a href="https://usethis.r-lib.org/reference/use_data.html" class="external-link">use_data</a></span><span class="op">(</span><span class="va">imputed_data</span>, overwrite <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">âœ”</span> Setting active project to <span style="color: #0000BB;">'/home/runner/work/dataPreparation/dataPreparation'</span></span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">âœ”</span> Saving <span style="color: #0000BB;">'imputed_data'</span> to <span style="color: #0000BB;">'data/imputed_data.rda'</span></span></span>
<span><span class="co">#&gt; <span style="color: #BB0000;">â€¢</span> Document your data (see <span style="color: #0000BB;">'https://r-pkgs.org/data.html'</span>)</span></span></code></pre></div>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/grDevices/png.html" class="external-link">png</a></span><span class="op">(</span><span class="st">"../man/figures/pca_plot_after_Batch_Correction.png"</span>, </span>
<span>    width<span class="op">=</span><span class="fl">1600</span>, height<span class="op">=</span><span class="fl">1200</span>, res<span class="op">=</span><span class="fl">220</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">pca_plot</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/grDevices/dev.html" class="external-link">dev.off</a></span><span class="op">(</span><span class="op">)</span> </span>
<span><span class="co">#&gt; agg_png </span></span>
<span><span class="co">#&gt;       2</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="conclusion">Conclusion<a class="anchor" aria-label="anchor" href="#conclusion"></a>
</h2>
<p>In conclusion, this report highlights the importance of comprehensive
data processing and batch correction techniques in ensuring the
reliability and interpretability of metabolomic data. By systematically
addressing batch effects and selecting informative features, I can
improve the robustness f downstream analyses and enhance the
understanding of biological phenomena.</p>
<p>This marks the end of the Data Processing Phase 2 Report.</p>
</div>
<div class="section level2">
<h2 id="clean-up-environment">Clean up environment<a class="anchor" aria-label="anchor" href="#clean-up-environment"></a>
</h2>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/rm.html" class="external-link">rm</a></span><span class="op">(</span>list <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ls.html" class="external-link">ls</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by <a href="https://danymukesha.github.io/" class="external-link">Dany Mukesha</a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
